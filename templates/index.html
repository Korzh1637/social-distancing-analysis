<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 1px solid #34495e;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        .status-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }
        .controls {
            background: white;
            padding: 25px;
            border-bottom: 1px solid #eee;
        }
        .control-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }
        select, input[type="file"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        select:focus, input[type="file"]:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            outline: none;
        }
        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .btn-start {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        .btn-stop {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .btn-test {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .btn-upload {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 0;
            min-height: 600px;
        }
        .video-container {
            background: #1a1a1a;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .video-container h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-align: center;
        }
        .video-wrapper {
            flex: 1;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #videoFeed {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }
        .video-placeholder {
            color: #666;
            text-align: center;
            padding: 40px;
        }
        .video-placeholder div {
            font-size: 4em;
            margin-bottom: 20px;
        }
        .video-info {
            text-align: center;
            margin-top: 15px;
            color: #bdc3c7;
            font-size: 1.1em;
        }
        .metrics-container {
            background: #f8f9fa;
            padding: 25px;
            border-left: 1px solid #e1e8ed;
            overflow-y: auto;
        }
        .metrics-container h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.4em;
            text-align: center;
        }
        .metric-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
            transition: transform 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-3px);
        }
        .metric-card strong {
            color: #2c3e50;
            font-size: 1.1em;
            display: block;
            margin-bottom: 8px;
        }
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }
        .violations-list, .events-log {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        .violations-list h4, .events-log h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        .violation-alert {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            transition: all 0.3s;
        }
        .violation-alert:hover {
            background: #ffeaa7;
        }
        .critical-violation {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .critical-violation:hover {
            background: #f5c6cb;
        }
        .status-indicator {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        .status-active {
            background: #27ae60;
            box-shadow: 0 0 10px #27ae60;
        }
        .status-inactive {
            background: #e74c3c;
        }
        .status-processing {
            background: #f39c12;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 25px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-width: 400px;
        }
        .notification.success { 
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .notification.error { 
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .notification.info { 
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        .notification.warning { 
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .event-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #3498db;
        }
        .event-time {
            font-size: 0.85em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        .event-message {
            color: #2c3e50;
            font-weight: 500;
        }
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .metrics-container {
                border-left: none;
                border-top: 1px solid #e1e8ed;
            }
        }
        @media (max-width: 768px) {
            .buttons {
                flex-direction: column;
            }
            button {
                min-width: 100%;
            }
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏</h1>
            <p>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            <div class="status-bar">
                <span class="status-indicator status-inactive" id="statusIndicator"></span>
                <span id="statusText">–°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>–ò—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ:</label>
                <select id="videoSource" onchange="onSourceChange()">
                    <option value="test">üé¨ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                    <option value="camera">üì∑ –í–µ–±-–∫–∞–º–µ—Ä–∞</option>
                    <option value="video_file">üé• –í–∏–¥–µ–æ—Ñ–∞–π–ª</option>
                </select>
            </div>

            <div class="control-group" id="cameraSelector" style="display: none;">
                <label>–í—ã–±–æ—Ä –∫–∞–º–µ—Ä—ã:</label>
                <select id="cameraIndex">
                    <option value="0">–ö–∞–º–µ—Ä–∞ 0 (–û—Å–Ω–æ–≤–Ω–∞—è)</option>
                    <option value="1">–ö–∞–º–µ—Ä–∞ 1</option>
                    <option value="2">–ö–∞–º–µ—Ä–∞ 2</option>
                </select>
            </div>

            <div class="control-group" id="videoUploadGroup" style="display: none;">
                <label>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞:</label>
                <input type="file" id="videoFile" accept="video/*">
                <button class="btn-upload" onclick="uploadVideo()" style="margin-top: 10px;">
                    üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
                </button>
            </div>

            <div class="buttons">
                <button class="btn-start" onclick="startProcessing()">
                    ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
                </button>
                <button class="btn-stop" onclick="stopProcessing()">
                    ‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞
                </button>
                <button class="btn-test" onclick="testConnection()">
                    üîç –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã
                </button>
            </div>
        </div>

        <div class="dashboard">
            <div class="video-container">
                <h3>üé• –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h3>
                <div class="video-wrapper">
                    <img id="videoFeed" src="" alt="–í–∏–¥–µ–æ–ø–æ—Ç–æ–∫" style="display: none;">
                    <div id="videoPlaceholder" class="video-placeholder">
                        <div>üìπ</div>
                        <h3>–í–∏–¥–µ–æ–ø–æ—Ç–æ–∫ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω</h3>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–∏–¥–µ–æ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏"</p>
                    </div>
                </div>
                <div class="video-info">
                    <span id="videoInfo">–†–µ–∂–∏–º: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞</span>
                </div>
            </div>

            <div class="metrics-container">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
                
                <div class="metric-grid">
                    <div class="metric-card">
                        <strong>–õ—é–¥–µ–π –≤ –∫–∞–¥—Ä–µ</strong>
                        <div class="metric-value" id="peopleCount">0</div>
                    </div>
                    <div class="metric-card">
                        <strong>–ù–∞—Ä—É—à–µ–Ω–∏—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏</strong>
                        <div class="metric-value" id="violationsCount">0</div>
                    </div>
                    <div class="metric-card">
                        <strong>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞</strong>
                        <div class="metric-value" id="density">0.0 <small>—á–µ–ª/–º¬≤</small></div>
                    </div>
                    <div class="metric-card">
                        <strong>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞</strong>
                        <div class="metric-value" id="riskLevel">–ù–∏–∑–∫–∏–π</div>
                    </div>
                    <div class="metric-card">
                        <strong>–¢–∏–ø –∑–æ–Ω—ã</strong>
                        <div class="metric-value" id="zoneType">default</div>
                    </div>
                </div>

                <div class="violations-list">
                    <h4>–ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è</h4>
                    <div id="violationsList">
                        <div class="violation-alert">
                            –ù–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
                        </div>
                    </div>
                </div>

                <div class="events-log">
                    <h4>–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h4>
                    <div id="eventsLog">
                        <div class="event-item">
                            <div class="event-time">–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞</div>
                            <div class="event-message">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let updateInterval;
        let frameUpdateInterval;
        let isProcessing = false;
        let currentVideoPath = null;

        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 5px;">${getNotificationIcon(type)}</div>
                <div>${message}</div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function getNotificationIcon(type) {
            const icons = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'info': '‚ÑπÔ∏è',
                'warning': '‚ö†Ô∏è'
            };
            return icons[type] || 'üí°';
        }

        function updateStatusIndicator(status) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = 'status-indicator';
            switch(status) {
                case 'active':
                    indicator.classList.add('status-active');
                    statusText.textContent = '–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ';
                    break;
                case 'processing':
                    indicator.classList.add('status-processing');
                    statusText.textContent = '–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...';
                    break;
                case 'inactive':
                    indicator.classList.add('status-inactive');
                    statusText.textContent = '–°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
                    break;
            }
        }

        function startFrameUpdates() {
            if (frameUpdateInterval) {
                clearInterval(frameUpdateInterval);
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–¥—Ä –∫–∞–∂–¥—ã–µ 100ms (10 FPS)
            frameUpdateInterval = setInterval(updateVideoFrame, 100);
        }

        function stopFrameUpdates() {
            if (frameUpdateInterval) {
                clearInterval(frameUpdateInterval);
                frameUpdateInterval = null;
            }
        }

        function updateVideoFrame() {
            fetch('/api/current_frame')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success && data.frame) {
                        const videoFeed = document.getElementById('videoFeed');
                        const videoPlaceholder = document.getElementById('videoPlaceholder');
                        
                        videoFeed.src = 'data:image/jpeg;base64,' + data.frame;
                        videoFeed.style.display = 'block';
                        videoPlaceholder.style.display = 'none';
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                        if (data.metrics) {
                            updateMetricsDisplay(data.metrics);
                        }
                    } else {
                        console.warn('No frame available:', data.error);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–¥—Ä–∞:', error);
                    if (!isProcessing) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞
                        const videoFeed = document.getElementById('videoFeed');
                        const videoPlaceholder = document.getElementById('videoPlaceholder');
                        videoFeed.style.display = 'none';
                        videoPlaceholder.style.display = 'flex';
                    }
                });
        }

        function updateMetricsDisplay(metrics) {
            document.getElementById('peopleCount').textContent = metrics.people_count || 0;
            document.getElementById('violationsCount').textContent = metrics.violations_count || 0;
            document.getElementById('density').innerHTML = (metrics.density ? metrics.density.toFixed(1) : '0.0') + ' <small>—á–µ–ª/–º¬≤</small>';
            document.getElementById('riskLevel').textContent = metrics.risk_level || '–ù–∏–∑–∫–∏–π';
            document.getElementById('zoneType').textContent = metrics.zone_type || 'default';
            
            // –¶–≤–µ—Ç —É—Ä–æ–≤–Ω—è —Ä–∏—Å–∫–∞
            const riskElement = document.getElementById('riskLevel');
            riskElement.style.color = 
                metrics.risk_level === '–í—ã—Å–æ–∫–∏–π' ? '#e74c3c' :
                metrics.risk_level === '–°—Ä–µ–¥–Ω–∏–π' ? '#f39c12' : '#27ae60';
        }

        function onSourceChange() {
            const source = document.getElementById('videoSource').value;
            document.getElementById('cameraSelector').style.display = source === 'camera' ? 'block' : 'none';
            document.getElementById('videoUploadGroup').style.display = source === 'video_file' ? 'block' : 'none';
        }

        function uploadVideo() {
            const fileInput = document.getElementById('videoFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('error', '‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª');
                return;
            }
            
            const formData = new FormData();
            formData.append('video', file);
            
            showNotification('info', '–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞...');
            
            fetch('/api/upload_video', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    currentVideoPath = data.file_path;
                    showNotification('success', '‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
                } else {
                    showNotification('error', '‚ùå ' + data.message);
                }
            })
            .catch(error => {
                showNotification('error', '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ: ' + error.message);
            });
        }

        function startProcessing() {
            const source = document.getElementById('videoSource').value;
            const requestData = { video_source: source };
            
            if (source === 'video_file') {
                if (!currentVideoPath) {
                    showNotification('error', '‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª');
                    return;
                }
                requestData.video_file_path = currentVideoPath;
            }
            
            updateStatusIndicator('processing');
            showNotification('info', '–ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ...');
            
            fetch('/api/start_processing', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showNotification('success', '‚úÖ ' + data.message);
                    updateStatusIndicator('active');
                    updateVideoInfo(data.video_source);
                    isProcessing = true;
                    startFrameUpdates();
                    startUpdatingMetrics();
                } else {
                    showNotification('error', '‚ùå ' + data.message);
                    updateStatusIndicator('inactive');
                }
            })
            .catch(error => {
                showNotification('error', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ' + error.message);
                updateStatusIndicator('inactive');
            });
        }

        function stopProcessing() {
            fetch('/api/stop_processing', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                showNotification('info', '‚èπÔ∏è ' + data.message);
                updateStatusIndicator('inactive');
                updateVideoInfo('–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                isProcessing = false;
                stopFrameUpdates();
            })
            .catch(error => {
                showNotification('error', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ: ' + error.message);
            });
        }

        function testConnection() {
            showNotification('info', '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º...');
            
            fetch('/api/health')
            .then(response => response.json())
            .then(data => {
                showNotification('success', 
                    `–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç<br>
                     –û–±—Ä–∞–±–æ—Ç–∫–∞: ${data.processing ? '–∞–∫—Ç–∏–≤–Ω–∞' : '–Ω–µ–∞–∫—Ç–∏–≤–Ω–∞'}<br>
                     –ò—Å—Ç–æ—á–Ω–∏–∫: ${data.video_source || '–Ω–µ –≤—ã–±—Ä–∞–Ω'}`
                );
            })
            .catch(error => {
                showNotification('error', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            });
        }

        function updateVideoInfo(source) {
            const sourceText = {
                'camera': '–í–µ–±-–∫–∞–º–µ—Ä–∞',
                'video_file': '–í–∏–¥–µ–æ—Ñ–∞–π–ª', 
                'test': '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º'
            }[source] || source;
            document.getElementById('videoInfo').textContent = `–†–µ–∂–∏–º: ${sourceText}`;
        }

        function startUpdatingMetrics() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            updateInterval = setInterval(updateAdditionalMetrics, 1000);
        }

        function updateAdditionalMetrics() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Ä—É—à–µ–Ω–∏—è
            fetch('/api/violations')
                .then(response => response.json())
                .then(violations => {
                    const violationsList = document.getElementById('violationsList');
                    
                    if (violations.length === 0) {
                        violationsList.innerHTML = '<div class="violation-alert">‚úÖ –ù–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>';
                    } else {
                        violationsList.innerHTML = '';
                        violations.forEach(violation => {
                            const div = document.createElement('div');
                            div.className = violation.violation_severity === 'critical' ? 
                                'violation-alert critical-violation' : 'violation-alert';
                            div.innerHTML = `
                                <strong>ID ${violation.person1} –∏ ${violation.person2}</strong><br>
                                –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${violation.distance.toFixed(2)}–º<br>
                                –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${violation.duration ? violation.duration.toFixed(1) + '—Å' : 'N/A'}<br>
                                <small>${violation.zone_description || ''}</small>
                            `;
                            violationsList.appendChild(div);
                        });
                    }
                })
                .catch(error => console.error('Error fetching violations:', error));

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è
            fetch('/api/events')
                .then(response => response.json())
                .then(events => {
                    const eventsLog = document.getElementById('eventsLog');
                    const recentEvents = events.slice(-5).reverse();
                    
                    eventsLog.innerHTML = '';
                    recentEvents.forEach(event => {
                        const div = document.createElement('div');
                        div.className = 'event-item';
                        div.innerHTML = `
                            <div class="event-time">${new Date(event.timestamp).toLocaleTimeString()}</div>
                            <div class="event-message">${event.message}</div>
                        `;
                        eventsLog.appendChild(div);
                    });
                })
                .catch(error => console.error('Error fetching events:', error));
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            onSourceChange();
            updateStatusIndicator('inactive');
            
            // –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–¥—Ä (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞)
            startFrameUpdates();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            testConnection();
            
            console.log('–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        });
    </script>
</body>
</html>